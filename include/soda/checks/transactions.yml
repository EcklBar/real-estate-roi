# Data quality checks for fact_transactions table
checks for fact_transactions:
  # Table must not be empty after ETL
  - row_count > 0:
      name: Transactions table is not empty

  # Price must be positive
  - invalid_count(price) = 0:
      name: All prices are positive
      valid min: 1

  # Price should be in reasonable range (10K - 100M ILS)
  - failed_rows_percent(price) < 5:
      name: Prices are in reasonable range
      fail condition: price < 10000 OR price > 100000000

  # Transaction date should not be in the future
  - invalid_count(transaction_date) = 0:
      name: No future transaction dates
      valid max: ${TODAY}

  # Location reference integrity
  - missing_count(location_id) = 0:
      name: All transactions have a location

  # Property reference integrity
  - missing_count(property_id) = 0:
      name: All transactions have a property

  # No duplicate source_ids
  - duplicate_count(source_id) = 0:
      name: No duplicate transactions

checks for dim_locations:
  # Table must not be empty
  - row_count > 0:
      name: Locations table is not empty

  # City must not be null
  - missing_count(city) = 0:
      name: All locations have a city

checks for dim_properties:
  # Table must not be empty
  - row_count > 0:
      name: Properties table is not empty

  # Rooms should be in reasonable range
  - invalid_count(rooms) = 0:
      name: Room count is reasonable
      valid min: 1
      valid max: 20

  # Size should be reasonable (10-1000 sqm)
  - failed_rows_percent(size_sqm) < 5:
      name: Property sizes are reasonable
      fail condition: size_sqm < 10 OR size_sqm > 1000
